

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Size and Shape of Chunks &#8212; Dask Data Chunking</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '101/EffectSizeShape';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing OpenDAP Data to ZARR on S3" href="OpenDAP_to_S3.html" />
    <link rel="prev" title="Examine Source Data" href="ExamineSourceData.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Work in progress...</div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/HyTEST_Badge.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/HyTEST_Badge.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About This Project</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Chunking 101</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ExamineSourceData.html">Examine Source Data</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Size and Shape of Chunks</a></li>
<li class="toctree-l2"><a class="reference internal" href="OpenDAP_to_S3.html">Writing OpenDAP Data to ZARR on S3</a></li>
<li class="toctree-l2"><a class="reference internal" href="Compression.html">Assessing Compression</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../back/index.html">Back Matter</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../helpers.html">Helper Scripts</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils.html">Utility Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../AWS.html">AWS Credentials Helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../StartNebariCluster.html">Starting a Cluster on Nebari</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../back/Appendix_A.html">Appendix A</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gzt5142/DaskDataChunking" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gzt5142/DaskDataChunking/issues/new?title=Issue%20on%20page%20%2F101/EffectSizeShape.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/101/EffectSizeShape.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Size and Shape of Chunks</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-chunk">Why Chunk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-data">Example Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-considerations">Shape Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dimension">Time Dimension</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#space">SPACE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#size-considerations">Size Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-chunk-size">Total Chunk Size</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-the-chunk-plan">Making the chunk plan</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="size-and-shape-of-chunks">
<h1>Size and Shape of Chunks<a class="headerlink" href="#size-and-shape-of-chunks" title="Permalink to this headline">#</a></h1>
<p><strong>OBJECTIVE</strong>:<br />
The objective of this chapter is to demonstrate how to read an existing dataset available as an OpenDAP endpoint, and translate it into a cloud-optimized zarr on S3.</p>
<p>This notebook will touch on chunking considerations – Factors to think about when deciding how to break up the data into chunks/bites. And why you would want to do that to begin with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python     : 3.10.10 | packaged by conda-forge | (main, Mar 24 2023, 20:08:06) [GCC 11.3.0]
xarray     : 2023.3.0
</pre></div>
</div>
</div>
</div>
<section id="why-chunk">
<h2>Why Chunk<a class="headerlink" href="#why-chunk" title="Permalink to this headline">#</a></h2>
<p>The simple reason is that the full dataset won’t fit in memory. It has to be
divided in some way so that only those parts of the data being actively worked
are loaded.</p>
<p>This has other benefits when it comes to parallel algorithms.  If work can be
performed in parallel, it is easy to set it up such that a separate worker is
assigned to each chunk of the data.</p>
</section>
<section id="example-data">
<h2>Example Data<a class="headerlink" href="#example-data" title="Permalink to this headline">#</a></h2>
<p>We’re going to keep looking at the sample PRISM dataset, as read from
an OpenDAP endpoint:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># INPUT: </span>
<span class="n">OPENDAP_url</span> <span class="o">=</span> <span class="s1">&#39;https://cida.usgs.gov/thredds/dodsC/prism_v2&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_in</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">OPENDAP_url</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ds_in</span><span class="o">.</span><span class="n">tmn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tmn&#x27; (time: 1512, lat: 621, lon: 1405)&gt;
[1319227560 values with dtype=float32]
Coordinates:
  * lon      (lon) float32 -125.0 -125.0 -124.9 -124.9 ... -66.6 -66.56 -66.52
  * lat      (lat) float32 49.94 49.9 49.85 49.81 ... 24.23 24.19 24.15 24.1
  * time     (time) float32 9.131e+03 9.162e+03 9.19e+03 ... 5.509e+04 5.512e+04
Attributes:
    long_name:    Minimum monthly temperature
    units:        degC
    _ChunkSizes:  [ 1 23 44]</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'tmn'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1512</li><li><span class='xr-has-index'>lat</span>: 621</li><li><span class='xr-has-index'>lon</span>: 1405</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-a3ed86ad-ebb8-447f-a25b-8334ae1a4001' class='xr-array-in' type='checkbox' checked><label for='section-a3ed86ad-ebb8-447f-a25b-8334ae1a4001' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>...</span></div><div class='xr-array-data'><pre>[1319227560 values with dtype=float32]</pre></div></div></li><li class='xr-section-item'><input id='section-e5983da3-fc63-4f80-8e65-e2c2a86bca8c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-e5983da3-fc63-4f80-8e65-e2c2a86bca8c' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-125.0 -125.0 ... -66.56 -66.52</div><input id='attrs-ca833706-2d86-4f49-a92b-6ff7bada58e3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ca833706-2d86-4f49-a92b-6ff7bada58e3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7b0ba49a-3bc1-409a-854d-59362d5cdeae' class='xr-var-data-in' type='checkbox'><label for='data-7b0ba49a-3bc1-409a-854d-59362d5cdeae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-125.020836, -124.979164, -124.9375  , ...,  -66.604164,  -66.5625  ,
        -66.520836], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>49.94 49.9 49.85 ... 24.15 24.1</div><input id='attrs-5faacf5c-5934-4285-9365-fa2fb10ed36e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5faacf5c-5934-4285-9365-fa2fb10ed36e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-779296f2-c08e-4a83-aad8-d3050bfe39ed' class='xr-var-data-in' type='checkbox'><label for='data-779296f2-c08e-4a83-aad8-d3050bfe39ed' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([49.9375  , 49.895832, 49.854168, ..., 24.1875  , 24.145834, 24.104166],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>9.131e+03 9.162e+03 ... 5.512e+04</div><input id='attrs-668a0158-b219-4581-a91b-c3ceb214d924' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-668a0158-b219-4581-a91b-c3ceb214d924' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec8f7ba3-31a0-408b-8bc0-3a83fc21aa5f' class='xr-var-data-in' type='checkbox'><label for='data-ec8f7ba3-31a0-408b-8bc0-3a83fc21aa5f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>calendar :</span></dt><dd>standard</dd><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>units :</span></dt><dd>days since 1870-01-01 00:00:00</dd><dt><span>_ChunkSizes :</span></dt><dd>1024</dd></dl></div><div class='xr-var-data'><pre>array([ 9131.,  9162.,  9190., ..., 55060., 55091., 55121.], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4577a692-da43-41c6-a0df-b9ff337ddde6' class='xr-section-summary-in' type='checkbox'  ><label for='section-4577a692-da43-41c6-a0df-b9ff337ddde6' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-07581d62-26bb-4443-8368-31b4e76e5117' class='xr-index-data-in' type='checkbox'/><label for='index-07581d62-26bb-4443-8368-31b4e76e5117' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([-125.02083587646484, -124.97916412353516,           -124.9375,
              -124.89583587646484, -124.85416412353516,           -124.8125,
              -124.77083587646484, -124.72916412353516,           -124.6875,
              -124.64583587646484,
              ...
               -66.89583587646484,  -66.85416412353516,            -66.8125,
               -66.77083587646484,  -66.72916412353516,            -66.6875,
               -66.64583587646484,  -66.60416412353516,            -66.5625,
               -66.52083587646484],
             dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=1405))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-2ffaa848-8a5e-4277-81a1-664ebb70b7d9' class='xr-index-data-in' type='checkbox'/><label for='index-2ffaa848-8a5e-4277-81a1-664ebb70b7d9' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([          49.9375, 49.89583206176758, 49.85416793823242,
                        49.8125, 49.77083206176758, 49.72916793823242,
                        49.6875, 49.64583206176758, 49.60416793823242,
                        49.5625,
              ...
              24.47916603088379,           24.4375, 24.39583396911621,
              24.35416603088379,           24.3125, 24.27083396911621,
              24.22916603088379,           24.1875, 24.14583396911621,
              24.10416603088379],
             dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=621))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-a251a002-99e4-4b28-ad8b-c009f2abb8e8' class='xr-index-data-in' type='checkbox'/><label for='index-a251a002-99e4-4b28-ad8b-c009f2abb8e8' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([ 9131.0,  9162.0,  9190.0,  9221.0,  9251.0,  9282.0,  9312.0,
               9343.0,  9374.0,  9404.0,
              ...
              54846.0, 54877.0, 54907.0, 54938.0, 54968.0, 54999.0, 55030.0,
              55060.0, 55091.0, 55121.0],
             dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=1512))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1bd59027-c135-4b8a-8fe7-da844e0ea5a4' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1bd59027-c135-4b8a-8fe7-da844e0ea5a4' class='xr-section-summary' >Attributes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Minimum monthly temperature</dd><dt><span>units :</span></dt><dd>degC</dd><dt><span>_ChunkSizes :</span></dt><dd>[ 1 23 44]</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Given what we know about this data, we can apply some cloud storage principles to form a strategy for how best to chunk the data when we write it to S3. Broadly, we need to specify chunk <strong>size</strong> and chunk <strong>shape</strong>.</p>
</section>
<section id="shape-considerations">
<h2>Shape Considerations<a class="headerlink" href="#shape-considerations" title="Permalink to this headline">#</a></h2>
<p>Shape refers to how to divide an array along each dimension.  So we will need to decide on the chunk size for each of the dimensions of this data.</p>
<p>The preferred shape of each chunk will depend on the read pattern for future analyses.
We will be chunking the data so that future reads will be performant – and that depends on whether
the data favors one dimension or another.  For some datasets, this will be very apparent (NWIS gages,
for example – it very likely will be consumed along the <code class="docutils literal notranslate"><span class="pre">time</span></code> dimension most often. It is <em>more likely</em>
that future analysis of this data will take a time series for a given gage, as opposed to taking all
gage data for a given time).  For datasets where there is no clear preference, we can try to chunk
based on likely read patterns, but allow for other patterns without too much of a performance penalty.</p>
<p>Let’s see how we might do this for our sample dataset.  This data will likely be used in one of two
dominant read patterns:</p>
<ul class="simple">
<li><p>Time series for a given location (or small spatial extent)</p>
<ul>
<li><p>As a special case – is it likely that time series will be subset by a logical unit? e.g. will this
monthly data be consumed in blocks of 12 (yearly)?</p></li>
</ul>
</li>
<li><p>Full extent for a given point in time.</p>
<ul>
<li><p>As a special case – are specific study areas more used than others?</p></li>
</ul>
</li>
</ul>
<p>Let’s look at a couple of options for space and time chunking:</p>
<section id="time-dimension">
<h3>Time Dimension<a class="headerlink" href="#time-dimension" title="Permalink to this headline">#</a></h3>
<p>The example dataset has 1512 time steps.  What happens if we chunk in groups of
twelve (i.e. a year at a time)?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We need </span><span class="si">{}</span><span class="s2"> chunks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1512</span> <span class="o">//</span> <span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We need 126 chunks.
</pre></div>
</div>
</div>
</div>
<p>In this case, a user could get an single year of this monthly data as a single chunk.
If they wanted a full time series across the entire dataset, they would need to read
126 chunks.</p>
<p>So this is where the judgement call gets made – which is the more likely read pattern
for time?  Year-by-year, or the whole time set (or some sequence of a few years). In
this case, I think it is more likely to want more than just one year’s data.  A happy
medium for chunk size is 6 years of data per chunk:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_chunk_size</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="mi">6</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TIME chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1512</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TIME chunking: 21.0 chunks of size 72
</pre></div>
</div>
</div>
</div>
<p>This pattern means only 21 chunks (instead of the 126 chunks we were considering a moment ago)
for a full time series in a given location. If we assume the rule-of-thumb latency for reading
and processing a chunk (100ms per read as the theoretical expectation – see “size” below),
those 21 chunks can be read by a single worker in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected latency in seconds: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Expected latency in seconds:  2.1
</pre></div>
</div>
</div>
</div>
<p>Note that for cluster-aware analyses, multiple chunks can be read at the same time. Total wall-clock time will be reduced in that case. With 21 chunks, maximum (theoretical) parallelism would be achieved with 21 cooperating workers.</p>
<p>We’ll move forward with the time dimension chunked into groups of <strong>72</strong> for this dataset.</p>
<section id="space">
<h4>SPACE<a class="headerlink" href="#space" title="Permalink to this headline">#</a></h4>
<p>We’re realy chunking in dimensions – and there are two dimensions to this dataset which
contribute to “space”: <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code>.  These can have separate chunk sizes. The question
to ask is whether future users of this data will want square “tiles” in space, or will
they want proportionally-sized longitude and latitude?  That is, is it important that the
North-South extent be broken into the same number of chunks as the East-West extent?).
I’ll be breaking this into square tiles, so there will be more <code class="docutils literal notranslate"><span class="pre">lon</span></code> chunks than <code class="docutils literal notranslate"><span class="pre">lat</span></code> chunks:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The size of the dataset: </span>
<span class="n">lon</span><span class="o">=</span><span class="mi">1405</span>
<span class="n">lat</span><span class="o">=</span><span class="mi">621</span>
<span class="n">test_chunk_size</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">//</span> <span class="mi">4</span> <span class="c1"># split the smaller of the two dimensions into 4 chunks</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LON chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lon</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LAT chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LON chunking: 9.064516129032258 chunks of size 155
LAT chunking: 4.006451612903226 chunks of size 155
</pre></div>
</div>
</div>
</div>
<p>It is important to note that we have <strong>just over</strong> a round number of chunks.
Having <code class="docutils literal notranslate"><span class="pre">9.06</span></code> longigutde chunks means we will have <code class="docutils literal notranslate"><span class="pre">10</span></code> chunks in practice, but
that last one is not full-sized. In this case, this means that the last chunk
in the given dimension will be extremely thin.</p>
<p>In the case of that latitude chunk size, the extra <code class="docutils literal notranslate"><span class="pre">0.006</span></code> of a chunk means that
the last, fractional, chunk is only one <code class="docutils literal notranslate"><span class="pre">lat</span></code> observation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#   remainder   chunksize</span>
<span class="mf">0.0064516129</span> <span class="o">*</span> <span class="mi">155</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999995
</pre></div>
</div>
</div>
</div>
<p>This all but guarantees that two chunks are needed for a small spatial extent
near the “end” of the <code class="docutils literal notranslate"><span class="pre">lat</span></code> dimension. Ideally, we would want partial chunks
to be at least half the size of the standard chunk.  The bigger that ‘remainder’
fraction, the better.</p>
<p>Let’s adjust numbers a little so that we don’t have that sliver.  We’re still
committed to square tiles, so let’s try a larger chunk size to change the size
of that last fraction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_chunk_size</span> <span class="o">=</span> <span class="mi">160</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LON chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lon</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LAT chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LON chunking: 8.78125 chunks of size 160
LAT chunking: 3.88125 chunks of size 160
</pre></div>
</div>
</div>
</div>
<p>With this pattern, the “remainder” latitude chunk will be 141 in the <code class="docutils literal notranslate"><span class="pre">lat</span></code> dimension (125
for the last <code class="docutils literal notranslate"><span class="pre">lon</span></code> chunk).  All others will be a square 160 observations in both directions.</p>
<p>This amounts to a 9x4 chunk grid, with the last chunk in each direction being partial.</p>
<p>The entire spatial extent for a single time step can be read in 36 chunks, with this pattern.
That feels a little high to me, given that this dataset will likely be taken at full extent
for a typical analysis.  Let’s go a little bigger to see what that gets us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_chunk_size</span> <span class="o">=</span> <span class="mi">354</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LON chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lon</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LAT chunking: </span><span class="si">{}</span><span class="s2"> chunks of size </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat</span> <span class="o">/</span> <span class="n">test_chunk_size</span><span class="p">,</span> <span class="n">test_chunk_size</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LON chunking: 3.968926553672316 chunks of size 354
LAT chunking: 1.7542372881355932 chunks of size 354
</pre></div>
</div>
</div>
</div>
<p>This is not <em>quite</em> as good in terms of full-chunk remainders – but on the other hand, the whole extent
can be had in only 8 chunks.  The smallest remainder is still 75% of a full-sized square tile, which is
acceptable.</p>
<p>Note, that if were really confident that most analyses wanted the full extent, we might
be better off to just put the whole lat/lon dimensions into single chunks each. This
would ensure (and <strong>require</strong>) that we read the entire extent any time we wanted any <strong>part</strong>
of the extent for a given timestep.  Our poor time-series analysis would then be stuck
reading the entire dataset to get all time values for a single location. <code class="docutils literal notranslate"><span class="pre">:sadface:</span></code></p>
<p>We’re going to move forward here with the <code class="docutils literal notranslate"><span class="pre">lat</span></code> and <code class="docutils literal notranslate"><span class="pre">lon</span></code> dimensions being chunked at <strong>354</strong>
observations each.</p>
</section>
</section>
</section>
<section id="size-considerations">
<h2>Size Considerations<a class="headerlink" href="#size-considerations" title="Permalink to this headline">#</a></h2>
<p>Shape is only part of the equation.  Total chunk size matters also.  Size considerations
come into play mostly as a consideration of how the chunks are stored on disk. The
retrieval time is influenced by the size of each chunk. Here are some constraints:</p>
<ul class="simple">
<li><p>Files Too Big – In a zarr dataset, each chunk is stored as a separate binary file.
If we need data from a particular chunk, no matter how little or how much, that file gets
opened, decompressed, and the whole thing read into memory. A large chunk sizes means
that there may be a lot of data transferred in situations when only a small subset of
that chunk’s data is actually needed.  It also means there might not be enough chunks
to allow the dask workers to stay busy loading data in parallel.</p></li>
<li><p>Files Too Small – If the chunk size is too small, the time it takes to read and
decompress the data for each chunk can become comparable to the latency of S3 (typically
10-100ms). We want the reads to take at least a second or so, so that the latency is
not a significant part of the overall timing.</p></li>
</ul>
<p>As a general rule, aim for chunk sizes between 10 and 200MB, depending on shape
and expected read pattern (see below). Expect 100ms latency for each separate
chunk that a process needs to open.</p>
<section id="total-chunk-size">
<h3>Total Chunk Size<a class="headerlink" href="#total-chunk-size" title="Permalink to this headline">#</a></h3>
<p>Now that we have a rough idea of the chunk dimensions, let’s compute its size in bytes.<br />
This will tell us if we’ve hit our target of between 10 and 200MB per chunk.  More
importantly, it will tell us if we will overwhelm the OpenDAP server – the server
can only give us 500MB at a time. Chunks should really be smaller than this (which
we want anyway, but this 500MB limit is a hard cut-off).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#       lat   lon  time  float32</span>
<span class="nb">bytes</span> <span class="o">=</span> <span class="mi">354</span> <span class="o">*</span> <span class="mi">354</span> <span class="o">*</span> <span class="mi">72</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">kbytes</span> <span class="o">=</span> <span class="nb">bytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mbytes</span> <span class="o">=</span> <span class="n">kbytes</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TMN chunk size: </span><span class="si">{</span><span class="nb">bytes</span><span class="si">=}</span><span class="s2"> (</span><span class="si">{</span><span class="n">kbytes</span><span class="si">=:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) (</span><span class="si">{</span><span class="n">mbytes</span><span class="si">=:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TMN chunk size: bytes=36091008 (kbytes=35245.12) (mbytes=34.4191)
</pre></div>
</div>
</div>
</div>
<p>We’re looking really good for size.  Maybe even a bit low.
But we’re in the (admitedly broad) range of 10-200 megabytes of
uncompressed data (i.e. in-memory) per chunk.</p>
</section>
</section>
<section id="making-the-chunk-plan">
<h2>Making the chunk plan<a class="headerlink" href="#making-the-chunk-plan" title="Permalink to this headline">#</a></h2>
<p>Now that we know how we want to chunk the data, we need to give that
information to the API which will read the data from its OpenDAP endpoint:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_in</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="n">OPENDAP_url</span><span class="p">,</span> 
    <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">chunks</span><span class="o">=</span><span class="p">{</span> <span class="c1">#this directs the open_dataset method to structure its reads in a particular way.</span>
        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> 
        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">,</span> 
        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">354</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">ds_in</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (lon: 1405, lat: 621, time: 1512, tbnd: 2)
Coordinates:
  * lon        (lon) float32 -125.0 -125.0 -124.9 -124.9 ... -66.6 -66.56 -66.52
  * lat        (lat) float32 49.94 49.9 49.85 49.81 ... 24.23 24.19 24.15 24.1
  * time       (time) float32 9.131e+03 9.162e+03 ... 5.509e+04 5.512e+04
Dimensions without coordinates: tbnd
Data variables:
    time_bnds  (time, tbnd) float32 dask.array&lt;chunksize=(72, 2), meta=np.ndarray&gt;
    tmx        (time, lat, lon) float32 dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;
    ppt        (time, lat, lon) float64 dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;
    tmn        (time, lat, lon) float32 dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;
Attributes: (12/24)
    Conventions:               CF-1.4
    acknowledgment:            PRISM Climate Group, Oregon State University, ...
    Metadata_Conventions:      Unidata Dataset Discovery v1.0
    title:                     Parameter-elevation Regressions on Independent...
    summary:                    This dataset was created using the PRISM (Par...
    keywords:                  Atmospheric Temperature, Air Temperature Atmos...
    ...                        ...
    time_coverage_start:       1895-01-01T00:00
    time_coverage_end:         2015-12-01T00:00
    time_coverage_resolution:  Monthly
    license:                   Freely Available: The PRISM Climate Group, Ore...
    authors:                   PRISM Climate Group
    institution:               Oregon State University</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a5162e03-9e3d-4428-a5f1-ec7c137b151b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a5162e03-9e3d-4428-a5f1-ec7c137b151b' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lon</span>: 1405</li><li><span class='xr-has-index'>lat</span>: 621</li><li><span class='xr-has-index'>time</span>: 1512</li><li><span>tbnd</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-5272b983-f815-4486-8918-06cc5b4e4376' class='xr-section-summary-in' type='checkbox'  checked><label for='section-5272b983-f815-4486-8918-06cc5b4e4376' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-125.0 -125.0 ... -66.56 -66.52</div><input id='attrs-e23738ae-5ef7-474d-bc97-cd49d515dec3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e23738ae-5ef7-474d-bc97-cd49d515dec3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8ef7fc9-93dc-4719-b67c-1b5d6fff2b9e' class='xr-var-data-in' type='checkbox'><label for='data-c8ef7fc9-93dc-4719-b67c-1b5d6fff2b9e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-125.020836, -124.979164, -124.9375  , ...,  -66.604164,  -66.5625  ,
        -66.520836], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>49.94 49.9 49.85 ... 24.15 24.1</div><input id='attrs-96366043-9a85-408b-91ca-be3395545290' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-96366043-9a85-408b-91ca-be3395545290' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9f8f7963-0dc4-47e5-806b-430fe4b906a8' class='xr-var-data-in' type='checkbox'><label for='data-9f8f7963-0dc4-47e5-806b-430fe4b906a8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([49.9375  , 49.895832, 49.854168, ..., 24.1875  , 24.145834, 24.104166],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>9.131e+03 9.162e+03 ... 5.512e+04</div><input id='attrs-b6ce31b4-6550-4daf-9883-16d7d4cd05b7' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b6ce31b4-6550-4daf-9883-16d7d4cd05b7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d6551e7e-ad4f-4e3f-8b92-2640d163b163' class='xr-var-data-in' type='checkbox'><label for='data-d6551e7e-ad4f-4e3f-8b92-2640d163b163' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>calendar :</span></dt><dd>standard</dd><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>units :</span></dt><dd>days since 1870-01-01 00:00:00</dd><dt><span>_ChunkSizes :</span></dt><dd>1024</dd></dl></div><div class='xr-var-data'><pre>array([ 9131.,  9162.,  9190., ..., 55060., 55091., 55121.], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-45fe4592-c1f4-468d-b7a2-19c7dc4af738' class='xr-section-summary-in' type='checkbox'  checked><label for='section-45fe4592-c1f4-468d-b7a2-19c7dc4af738' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, tbnd)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(72, 2), meta=np.ndarray&gt;</div><input id='attrs-2f20f67d-e742-471a-9643-a61e69c5c99e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2f20f67d-e742-471a-9643-a61e69c5c99e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7f1930cf-e357-42fc-92d2-4c469fb9e258' class='xr-var-data-in' type='checkbox'><label for='data-7f1930cf-e357-42fc-92d2-4c469fb9e258' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Time interval endpoints</dd><dt><span>_ChunkSizes :</span></dt><dd>[1 2]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 11.81 kiB </td>
                        <td> 576 B </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1512, 2) </td>
                        <td> (72, 2) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 21 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="75" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="25" y2="0" style="stroke-width:2" />
  <line x1="0" y1="5" x2="25" y2="5" />
  <line x1="0" y1="11" x2="25" y2="11" />
  <line x1="0" y1="17" x2="25" y2="17" />
  <line x1="0" y1="22" x2="25" y2="22" />
  <line x1="0" y1="28" x2="25" y2="28" />
  <line x1="0" y1="34" x2="25" y2="34" />
  <line x1="0" y1="40" x2="25" y2="40" />
  <line x1="0" y1="45" x2="25" y2="45" />
  <line x1="0" y1="51" x2="25" y2="51" />
  <line x1="0" y1="62" x2="25" y2="62" />
  <line x1="0" y1="68" x2="25" y2="68" />
  <line x1="0" y1="74" x2="25" y2="74" />
  <line x1="0" y1="80" x2="25" y2="80" />
  <line x1="0" y1="85" x2="25" y2="85" />
  <line x1="0" y1="91" x2="25" y2="91" />
  <line x1="0" y1="97" x2="25" y2="97" />
  <line x1="0" y1="102" x2="25" y2="102" />
  <line x1="0" y1="108" x2="25" y2="108" />
  <line x1="0" y1="120" x2="25" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="25" y1="0" x2="25" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 25.412616514582485,0.0 25.412616514582485,120.0 0.0,120.0" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="12.706308" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >2</text>
  <text x="45.412617" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,45.412617,60.000000)">1512</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tmx</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;</div><input id='attrs-d0e0c073-9cc5-4f47-9a37-f3f2f161ba90' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d0e0c073-9cc5-4f47-9a37-f3f2f161ba90' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d5c86688-09c4-4ddf-a9d6-aa06a073d7e5' class='xr-var-data-in' type='checkbox'><label for='data-d5c86688-09c4-4ddf-a9d6-aa06a073d7e5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Maximum monthly temperature</dd><dt><span>units :</span></dt><dd>degC</dd><dt><span>_ChunkSizes :</span></dt><dd>[ 1 23 44]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.91 GiB </td>
                        <td> 34.42 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1512, 621, 1405) </td>
                        <td> (72, 354, 354) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 168 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="242" height="169" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="28" x2="80" y2="98" />
  <line x1="10" y1="49" x2="80" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="49" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="52" />
  <line x1="16" y1="6" x2="16" y2="56" />
  <line x1="20" y1="10" x2="20" y2="59" />
  <line x1="23" y1="13" x2="23" y2="62" />
  <line x1="26" y1="16" x2="26" y2="66" />
  <line x1="30" y1="20" x2="30" y2="69" />
  <line x1="33" y1="23" x2="33" y2="72" />
  <line x1="36" y1="26" x2="36" y2="76" />
  <line x1="40" y1="30" x2="40" y2="79" />
  <line x1="46" y1="36" x2="46" y2="86" />
  <line x1="50" y1="40" x2="50" y2="89" />
  <line x1="53" y1="43" x2="53" y2="92" />
  <line x1="57" y1="47" x2="57" y2="96" />
  <line x1="60" y1="50" x2="60" y2="99" />
  <line x1="63" y1="53" x2="63" y2="103" />
  <line x1="67" y1="57" x2="67" y2="106" />
  <line x1="70" y1="60" x2="70" y2="109" />
  <line x1="73" y1="63" x2="73" y2="113" />
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,119.87394957983193 10.0,49.285714285714285" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="121" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="124" y2="3" />
  <line x1="16" y1="6" x2="128" y2="6" />
  <line x1="20" y1="10" x2="131" y2="10" />
  <line x1="23" y1="13" x2="134" y2="13" />
  <line x1="26" y1="16" x2="138" y2="16" />
  <line x1="30" y1="20" x2="141" y2="20" />
  <line x1="33" y1="23" x2="145" y2="23" />
  <line x1="36" y1="26" x2="148" y2="26" />
  <line x1="40" y1="30" x2="151" y2="30" />
  <line x1="46" y1="36" x2="158" y2="36" />
  <line x1="50" y1="40" x2="161" y2="40" />
  <line x1="53" y1="43" x2="165" y2="43" />
  <line x1="57" y1="47" x2="168" y2="47" />
  <line x1="60" y1="50" x2="171" y2="50" />
  <line x1="63" y1="53" x2="175" y2="53" />
  <line x1="67" y1="57" x2="178" y2="57" />
  <line x1="70" y1="60" x2="182" y2="60" />
  <line x1="73" y1="63" x2="185" y2="63" />
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="38" y1="0" x2="108" y2="70" />
  <line x1="66" y1="0" x2="136" y2="70" />
  <line x1="94" y1="0" x2="164" y2="70" />
  <line x1="121" y1="0" x2="192" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 121.5079365079365,0.0 192.09617180205416,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />
  <line x1="80" y1="98" x2="192" y2="98" />
  <line x1="80" y1="119" x2="192" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />
  <line x1="108" y1="70" x2="108" y2="119" />
  <line x1="136" y1="70" x2="136" y2="119" />
  <line x1="164" y1="70" x2="164" y2="119" />
  <line x1="192" y1="70" x2="192" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 192.09617180205416,70.58823529411765 192.09617180205416,119.87394957983193 80.58823529411765,119.87394957983193" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="136.342204" y="139.873950" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="212.096172" y="95.231092" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,212.096172,95.231092)">621</text>
  <text x="35.294118" y="104.579832" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,104.579832)">1512</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ppt</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;</div><input id='attrs-50d1e07d-3845-467a-9824-03f2c9efeebd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-50d1e07d-3845-467a-9824-03f2c9efeebd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-760394d6-6b1a-4234-a5c1-ed3f9e15bcfb' class='xr-var-data-in' type='checkbox'><label for='data-760394d6-6b1a-4234-a5c1-ed3f9e15bcfb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Mean monthly precipitation</dd><dt><span>units :</span></dt><dd>mm/month</dd><dt><span>_ChunkSizes :</span></dt><dd>[ 1 23 44]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 9.83 GiB </td>
                        <td> 68.84 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1512, 621, 1405) </td>
                        <td> (72, 354, 354) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 168 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="242" height="169" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="28" x2="80" y2="98" />
  <line x1="10" y1="49" x2="80" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="49" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="52" />
  <line x1="16" y1="6" x2="16" y2="56" />
  <line x1="20" y1="10" x2="20" y2="59" />
  <line x1="23" y1="13" x2="23" y2="62" />
  <line x1="26" y1="16" x2="26" y2="66" />
  <line x1="30" y1="20" x2="30" y2="69" />
  <line x1="33" y1="23" x2="33" y2="72" />
  <line x1="36" y1="26" x2="36" y2="76" />
  <line x1="40" y1="30" x2="40" y2="79" />
  <line x1="46" y1="36" x2="46" y2="86" />
  <line x1="50" y1="40" x2="50" y2="89" />
  <line x1="53" y1="43" x2="53" y2="92" />
  <line x1="57" y1="47" x2="57" y2="96" />
  <line x1="60" y1="50" x2="60" y2="99" />
  <line x1="63" y1="53" x2="63" y2="103" />
  <line x1="67" y1="57" x2="67" y2="106" />
  <line x1="70" y1="60" x2="70" y2="109" />
  <line x1="73" y1="63" x2="73" y2="113" />
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,119.87394957983193 10.0,49.285714285714285" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="121" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="124" y2="3" />
  <line x1="16" y1="6" x2="128" y2="6" />
  <line x1="20" y1="10" x2="131" y2="10" />
  <line x1="23" y1="13" x2="134" y2="13" />
  <line x1="26" y1="16" x2="138" y2="16" />
  <line x1="30" y1="20" x2="141" y2="20" />
  <line x1="33" y1="23" x2="145" y2="23" />
  <line x1="36" y1="26" x2="148" y2="26" />
  <line x1="40" y1="30" x2="151" y2="30" />
  <line x1="46" y1="36" x2="158" y2="36" />
  <line x1="50" y1="40" x2="161" y2="40" />
  <line x1="53" y1="43" x2="165" y2="43" />
  <line x1="57" y1="47" x2="168" y2="47" />
  <line x1="60" y1="50" x2="171" y2="50" />
  <line x1="63" y1="53" x2="175" y2="53" />
  <line x1="67" y1="57" x2="178" y2="57" />
  <line x1="70" y1="60" x2="182" y2="60" />
  <line x1="73" y1="63" x2="185" y2="63" />
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="38" y1="0" x2="108" y2="70" />
  <line x1="66" y1="0" x2="136" y2="70" />
  <line x1="94" y1="0" x2="164" y2="70" />
  <line x1="121" y1="0" x2="192" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 121.5079365079365,0.0 192.09617180205416,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />
  <line x1="80" y1="98" x2="192" y2="98" />
  <line x1="80" y1="119" x2="192" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />
  <line x1="108" y1="70" x2="108" y2="119" />
  <line x1="136" y1="70" x2="136" y2="119" />
  <line x1="164" y1="70" x2="164" y2="119" />
  <line x1="192" y1="70" x2="192" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 192.09617180205416,70.58823529411765 192.09617180205416,119.87394957983193 80.58823529411765,119.87394957983193" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="136.342204" y="139.873950" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="212.096172" y="95.231092" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,212.096172,95.231092)">621</text>
  <text x="35.294118" y="104.579832" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,104.579832)">1512</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tmn</span></div><div class='xr-var-dims'>(time, lat, lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;</div><input id='attrs-b8336181-5fa7-4bb6-9478-3caedc5cb942' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b8336181-5fa7-4bb6-9478-3caedc5cb942' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ac70b7d0-a5c9-4274-9687-3f48633b6212' class='xr-var-data-in' type='checkbox'><label for='data-ac70b7d0-a5c9-4274-9687-3f48633b6212' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Minimum monthly temperature</dd><dt><span>units :</span></dt><dd>degC</dd><dt><span>_ChunkSizes :</span></dt><dd>[ 1 23 44]</dd></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.91 GiB </td>
                        <td> 34.42 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1512, 621, 1405) </td>
                        <td> (72, 354, 354) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 168 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="242" height="169" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="28" x2="80" y2="98" />
  <line x1="10" y1="49" x2="80" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="49" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="52" />
  <line x1="16" y1="6" x2="16" y2="56" />
  <line x1="20" y1="10" x2="20" y2="59" />
  <line x1="23" y1="13" x2="23" y2="62" />
  <line x1="26" y1="16" x2="26" y2="66" />
  <line x1="30" y1="20" x2="30" y2="69" />
  <line x1="33" y1="23" x2="33" y2="72" />
  <line x1="36" y1="26" x2="36" y2="76" />
  <line x1="40" y1="30" x2="40" y2="79" />
  <line x1="46" y1="36" x2="46" y2="86" />
  <line x1="50" y1="40" x2="50" y2="89" />
  <line x1="53" y1="43" x2="53" y2="92" />
  <line x1="57" y1="47" x2="57" y2="96" />
  <line x1="60" y1="50" x2="60" y2="99" />
  <line x1="63" y1="53" x2="63" y2="103" />
  <line x1="67" y1="57" x2="67" y2="106" />
  <line x1="70" y1="60" x2="70" y2="109" />
  <line x1="73" y1="63" x2="73" y2="113" />
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,119.87394957983193 10.0,49.285714285714285" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="121" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="124" y2="3" />
  <line x1="16" y1="6" x2="128" y2="6" />
  <line x1="20" y1="10" x2="131" y2="10" />
  <line x1="23" y1="13" x2="134" y2="13" />
  <line x1="26" y1="16" x2="138" y2="16" />
  <line x1="30" y1="20" x2="141" y2="20" />
  <line x1="33" y1="23" x2="145" y2="23" />
  <line x1="36" y1="26" x2="148" y2="26" />
  <line x1="40" y1="30" x2="151" y2="30" />
  <line x1="46" y1="36" x2="158" y2="36" />
  <line x1="50" y1="40" x2="161" y2="40" />
  <line x1="53" y1="43" x2="165" y2="43" />
  <line x1="57" y1="47" x2="168" y2="47" />
  <line x1="60" y1="50" x2="171" y2="50" />
  <line x1="63" y1="53" x2="175" y2="53" />
  <line x1="67" y1="57" x2="178" y2="57" />
  <line x1="70" y1="60" x2="182" y2="60" />
  <line x1="73" y1="63" x2="185" y2="63" />
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="38" y1="0" x2="108" y2="70" />
  <line x1="66" y1="0" x2="136" y2="70" />
  <line x1="94" y1="0" x2="164" y2="70" />
  <line x1="121" y1="0" x2="192" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 121.5079365079365,0.0 192.09617180205416,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />
  <line x1="80" y1="98" x2="192" y2="98" />
  <line x1="80" y1="119" x2="192" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />
  <line x1="108" y1="70" x2="108" y2="119" />
  <line x1="136" y1="70" x2="136" y2="119" />
  <line x1="164" y1="70" x2="164" y2="119" />
  <line x1="192" y1="70" x2="192" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 192.09617180205416,70.58823529411765 192.09617180205416,119.87394957983193 80.58823529411765,119.87394957983193" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="136.342204" y="139.873950" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="212.096172" y="95.231092" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,212.096172,95.231092)">621</text>
  <text x="35.294118" y="104.579832" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,104.579832)">1512</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-528d29c5-27a5-42f8-842d-222f1db5f87c' class='xr-section-summary-in' type='checkbox'  ><label for='section-528d29c5-27a5-42f8-842d-222f1db5f87c' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-bb6cadf4-86c8-44b9-a951-7db8d56a438f' class='xr-index-data-in' type='checkbox'/><label for='index-bb6cadf4-86c8-44b9-a951-7db8d56a438f' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([-125.02083587646484, -124.97916412353516,           -124.9375,
              -124.89583587646484, -124.85416412353516,           -124.8125,
              -124.77083587646484, -124.72916412353516,           -124.6875,
              -124.64583587646484,
              ...
               -66.89583587646484,  -66.85416412353516,            -66.8125,
               -66.77083587646484,  -66.72916412353516,            -66.6875,
               -66.64583587646484,  -66.60416412353516,            -66.5625,
               -66.52083587646484],
             dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=1405))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-4a470d15-31d4-4b89-ac32-6db53076f9fb' class='xr-index-data-in' type='checkbox'/><label for='index-4a470d15-31d4-4b89-ac32-6db53076f9fb' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([          49.9375, 49.89583206176758, 49.85416793823242,
                        49.8125, 49.77083206176758, 49.72916793823242,
                        49.6875, 49.64583206176758, 49.60416793823242,
                        49.5625,
              ...
              24.47916603088379,           24.4375, 24.39583396911621,
              24.35416603088379,           24.3125, 24.27083396911621,
              24.22916603088379,           24.1875, 24.14583396911621,
              24.10416603088379],
             dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=621))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-bc2f495d-59c1-4905-9dd0-448bc9365102' class='xr-index-data-in' type='checkbox'/><label for='index-bc2f495d-59c1-4905-9dd0-448bc9365102' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([ 9131.0,  9162.0,  9190.0,  9221.0,  9251.0,  9282.0,  9312.0,
               9343.0,  9374.0,  9404.0,
              ...
              54846.0, 54877.0, 54907.0, 54938.0, 54968.0, 54999.0, 55030.0,
              55060.0, 55091.0, 55121.0],
             dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=1512))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f119af5f-1259-416f-97e0-6d27738c3d7c' class='xr-section-summary-in' type='checkbox'  ><label for='section-f119af5f-1259-416f-97e0-6d27738c3d7c' class='xr-section-summary' >Attributes: <span>(24)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.4</dd><dt><span>acknowledgment :</span></dt><dd>PRISM Climate Group, Oregon State University, http://prism.oregonstate.edu, Accessed July 2016.</dd><dt><span>Metadata_Conventions :</span></dt><dd>Unidata Dataset Discovery v1.0</dd><dt><span>title :</span></dt><dd>Parameter-elevation Regressions on Independent Slopes Model Monthly Climate Data for the Continental United States. July 2016 Snapshot</dd><dt><span>summary :</span></dt><dd> This dataset was created using the PRISM (Parameter-elevation Regressions on Independent Slopes Model) climate mapping system, developed by Dr. Christopher Daly, PRISM Climate Group director. PRISM is a unique knowledge-based system that uses point measurements of precipitation, temperature, and other climatic factors to produce continuous, digital grid estimates of monthly, yearly, and event-based climatic parameters. Continuously updated, this unique analytical tool incorporates point data, a digital elevation model, and expert knowledge of complex climatic extremes, including rain shadows, coastal effects, and temperature inversions. PRISM data sets are recognized world-wide as the highest-quality spatial climate data sets currently available. PRISM is the USDA&#x27;s official climatological data. </dd><dt><span>keywords :</span></dt><dd>Atmospheric Temperature, Air Temperature Atmosphere, Precipitation, Rain, Maximum Daily Temperature, Minimum  Daily Temperature</dd><dt><span>keywords_vocabulary :</span></dt><dd>GCMD Science Keywords</dd><dt><span>id :</span></dt><dd>prism/thredds/cida.usgs.gov</dd><dt><span>naming_authority :</span></dt><dd>cida.usgs.gov</dd><dt><span>cdm_data_type :</span></dt><dd>Grid</dd><dt><span>creator_name :</span></dt><dd>Christopher Daley</dd><dt><span>creator_email :</span></dt><dd>daley@nacse.org</dd><dt><span>publisher_name :</span></dt><dd>PRISM Climate Group</dd><dt><span>publisher_url :</span></dt><dd>http://prism.oregonstate.edu/</dd><dt><span>geospatial_lat_min :</span></dt><dd>24</dd><dt><span>geospatial_lat_max :</span></dt><dd>53</dd><dt><span>geospatial_lon_min :</span></dt><dd>-125</dd><dt><span>geospatial_lon_max :</span></dt><dd>-67</dd><dt><span>time_coverage_start :</span></dt><dd>1895-01-01T00:00</dd><dt><span>time_coverage_end :</span></dt><dd>2015-12-01T00:00</dd><dt><span>time_coverage_resolution :</span></dt><dd>Monthly</dd><dt><span>license :</span></dt><dd>Freely Available: The PRISM Climate Group, Oregon State University retains rights to ownership of the data and information.</dd><dt><span>authors :</span></dt><dd>PRISM Climate Group</dd><dt><span>institution :</span></dt><dd>Oregon State University</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>Looking more closely at the <code class="docutils literal notranslate"><span class="pre">tmn</span></code> variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_in</span><span class="o">.</span><span class="n">tmn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tmn&#x27; (time: 1512, lat: 621, lon: 1405)&gt;
dask.array&lt;open_dataset-9e079ee350eae1c47bad035cd649cf4btmn, shape=(1512, 621, 1405), dtype=float32, chunksize=(72, 354, 354), chunktype=numpy.ndarray&gt;
Coordinates:
  * lon      (lon) float32 -125.0 -125.0 -124.9 -124.9 ... -66.6 -66.56 -66.52
  * lat      (lat) float32 49.94 49.9 49.85 49.81 ... 24.23 24.19 24.15 24.1
  * time     (time) float32 9.131e+03 9.162e+03 9.19e+03 ... 5.509e+04 5.512e+04
Attributes:
    long_name:    Minimum monthly temperature
    units:        degC
    _ChunkSizes:  [ 1 23 44]</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'tmn'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 1512</li><li><span class='xr-has-index'>lat</span>: 621</li><li><span class='xr-has-index'>lon</span>: 1405</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-b3732422-88ab-4580-98f1-794c5df94581' class='xr-array-in' type='checkbox' checked><label for='section-b3732422-88ab-4580-98f1-794c5df94581' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(72, 354, 354), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 4.91 GiB </td>
                        <td> 34.42 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (1512, 621, 1405) </td>
                        <td> (72, 354, 354) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 168 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="242" height="169" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="10" y1="28" x2="80" y2="98" />
  <line x1="10" y1="49" x2="80" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="49" style="stroke-width:2" />
  <line x1="13" y1="3" x2="13" y2="52" />
  <line x1="16" y1="6" x2="16" y2="56" />
  <line x1="20" y1="10" x2="20" y2="59" />
  <line x1="23" y1="13" x2="23" y2="62" />
  <line x1="26" y1="16" x2="26" y2="66" />
  <line x1="30" y1="20" x2="30" y2="69" />
  <line x1="33" y1="23" x2="33" y2="72" />
  <line x1="36" y1="26" x2="36" y2="76" />
  <line x1="40" y1="30" x2="40" y2="79" />
  <line x1="46" y1="36" x2="46" y2="86" />
  <line x1="50" y1="40" x2="50" y2="89" />
  <line x1="53" y1="43" x2="53" y2="92" />
  <line x1="57" y1="47" x2="57" y2="96" />
  <line x1="60" y1="50" x2="60" y2="99" />
  <line x1="63" y1="53" x2="63" y2="103" />
  <line x1="67" y1="57" x2="67" y2="106" />
  <line x1="70" y1="60" x2="70" y2="109" />
  <line x1="73" y1="63" x2="73" y2="113" />
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 80.58823529411765,70.58823529411765 80.58823529411765,119.87394957983193 10.0,49.285714285714285" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="121" y2="0" style="stroke-width:2" />
  <line x1="13" y1="3" x2="124" y2="3" />
  <line x1="16" y1="6" x2="128" y2="6" />
  <line x1="20" y1="10" x2="131" y2="10" />
  <line x1="23" y1="13" x2="134" y2="13" />
  <line x1="26" y1="16" x2="138" y2="16" />
  <line x1="30" y1="20" x2="141" y2="20" />
  <line x1="33" y1="23" x2="145" y2="23" />
  <line x1="36" y1="26" x2="148" y2="26" />
  <line x1="40" y1="30" x2="151" y2="30" />
  <line x1="46" y1="36" x2="158" y2="36" />
  <line x1="50" y1="40" x2="161" y2="40" />
  <line x1="53" y1="43" x2="165" y2="43" />
  <line x1="57" y1="47" x2="168" y2="47" />
  <line x1="60" y1="50" x2="171" y2="50" />
  <line x1="63" y1="53" x2="175" y2="53" />
  <line x1="67" y1="57" x2="178" y2="57" />
  <line x1="70" y1="60" x2="182" y2="60" />
  <line x1="73" y1="63" x2="185" y2="63" />
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="80" y2="70" style="stroke-width:2" />
  <line x1="38" y1="0" x2="108" y2="70" />
  <line x1="66" y1="0" x2="136" y2="70" />
  <line x1="94" y1="0" x2="164" y2="70" />
  <line x1="121" y1="0" x2="192" y2="70" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 121.5079365079365,0.0 192.09617180205416,70.58823529411765 80.58823529411765,70.58823529411765" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="80" y1="70" x2="192" y2="70" style="stroke-width:2" />
  <line x1="80" y1="98" x2="192" y2="98" />
  <line x1="80" y1="119" x2="192" y2="119" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="80" y1="70" x2="80" y2="119" style="stroke-width:2" />
  <line x1="108" y1="70" x2="108" y2="119" />
  <line x1="136" y1="70" x2="136" y2="119" />
  <line x1="164" y1="70" x2="164" y2="119" />
  <line x1="192" y1="70" x2="192" y2="119" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="80.58823529411765,70.58823529411765 192.09617180205416,70.58823529411765 192.09617180205416,119.87394957983193 80.58823529411765,119.87394957983193" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="136.342204" y="139.873950" font-size="1.0rem" font-weight="100" text-anchor="middle" >1405</text>
  <text x="212.096172" y="95.231092" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,212.096172,95.231092)">621</text>
  <text x="35.294118" y="104.579832" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,35.294118,104.579832)">1512</text>
</svg>
        </td>
    </tr>
</table></div></div></li><li class='xr-section-item'><input id='section-32d57580-59fb-412d-938a-406e65fd93e7' class='xr-section-summary-in' type='checkbox'  checked><label for='section-32d57580-59fb-412d-938a-406e65fd93e7' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-125.0 -125.0 ... -66.56 -66.52</div><input id='attrs-d9c20cd5-cbbe-4578-8e95-37efa6a33bdc' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d9c20cd5-cbbe-4578-8e95-37efa6a33bdc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2e10b94d-7b84-4999-b9fe-ae517f49f72d' class='xr-var-data-in' type='checkbox'><label for='data-2e10b94d-7b84-4999-b9fe-ae517f49f72d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-125.020836, -124.979164, -124.9375  , ...,  -66.604164,  -66.5625  ,
        -66.520836], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>49.94 49.9 49.85 ... 24.15 24.1</div><input id='attrs-04d286de-80d6-4340-bd8e-c69f4f76e062' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-04d286de-80d6-4340-bd8e-c69f4f76e062' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-02bd9fac-0ca6-4252-b731-bb1674d96812' class='xr-var-data-in' type='checkbox'><label for='data-02bd9fac-0ca6-4252-b731-bb1674d96812' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([49.9375  , 49.895832, 49.854168, ..., 24.1875  , 24.145834, 24.104166],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>9.131e+03 9.162e+03 ... 5.512e+04</div><input id='attrs-abf4b9f5-f10b-41ee-901c-a0c78fbfd998' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-abf4b9f5-f10b-41ee-901c-a0c78fbfd998' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0ce8128a-ce9f-439b-86f7-9b74ea0d8cec' class='xr-var-data-in' type='checkbox'><label for='data-0ce8128a-ce9f-439b-86f7-9b74ea0d8cec' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>calendar :</span></dt><dd>standard</dd><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>units :</span></dt><dd>days since 1870-01-01 00:00:00</dd><dt><span>_ChunkSizes :</span></dt><dd>1024</dd></dl></div><div class='xr-var-data'><pre>array([ 9131.,  9162.,  9190., ..., 55060., 55091., 55121.], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-50b77c66-f36d-483d-83db-7c0326ea2f6b' class='xr-section-summary-in' type='checkbox'  ><label for='section-50b77c66-f36d-483d-83db-7c0326ea2f6b' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-930613be-2db2-43d4-b30c-ad76378147e8' class='xr-index-data-in' type='checkbox'/><label for='index-930613be-2db2-43d4-b30c-ad76378147e8' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([-125.02083587646484, -124.97916412353516,           -124.9375,
              -124.89583587646484, -124.85416412353516,           -124.8125,
              -124.77083587646484, -124.72916412353516,           -124.6875,
              -124.64583587646484,
              ...
               -66.89583587646484,  -66.85416412353516,            -66.8125,
               -66.77083587646484,  -66.72916412353516,            -66.6875,
               -66.64583587646484,  -66.60416412353516,            -66.5625,
               -66.52083587646484],
             dtype=&#x27;float64&#x27;, name=&#x27;lon&#x27;, length=1405))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-fbbeaa2b-97ff-49dd-9a33-f1aae887ceed' class='xr-index-data-in' type='checkbox'/><label for='index-fbbeaa2b-97ff-49dd-9a33-f1aae887ceed' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([          49.9375, 49.89583206176758, 49.85416793823242,
                        49.8125, 49.77083206176758, 49.72916793823242,
                        49.6875, 49.64583206176758, 49.60416793823242,
                        49.5625,
              ...
              24.47916603088379,           24.4375, 24.39583396911621,
              24.35416603088379,           24.3125, 24.27083396911621,
              24.22916603088379,           24.1875, 24.14583396911621,
              24.10416603088379],
             dtype=&#x27;float64&#x27;, name=&#x27;lat&#x27;, length=621))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-7ee6313e-9df1-4125-8e7f-3c574049f408' class='xr-index-data-in' type='checkbox'/><label for='index-7ee6313e-9df1-4125-8e7f-3c574049f408' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Float64Index([ 9131.0,  9162.0,  9190.0,  9221.0,  9251.0,  9282.0,  9312.0,
               9343.0,  9374.0,  9404.0,
              ...
              54846.0, 54877.0, 54907.0, 54938.0, 54968.0, 54999.0, 55030.0,
              55060.0, 55091.0, 55121.0],
             dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=1512))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-dbece62c-ce01-4ad2-8261-acc427b85f67' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dbece62c-ce01-4ad2-8261-acc427b85f67' class='xr-section-summary' >Attributes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>long_name :</span></dt><dd>Minimum monthly temperature</dd><dt><span>units :</span></dt><dd>degC</dd><dt><span>_ChunkSizes :</span></dt><dd>[ 1 23 44]</dd></dl></div></li></ul></div></div></div></div>
</div>
<p><strong>NOTE</strong> that the display looks differently than it does in the <a class="reference internal" href="ExamineSourceData.html"><span class="doc">Examine Source Data</span></a> notebook.
In that original data examination (when we did not express a chunking preference), the data was
described as <code class="docutils literal notranslate"><span class="pre">1319227560</span> <span class="pre">values</span> <span class="pre">with</span> <span class="pre">dtype=float32</span></code>.  In the above data description, you can see
that those observations are structured in the chunks that we’ve asked for.  Notice that the
<code class="docutils literal notranslate"><span class="pre">xarray</span></code> description of chunk size matches our rough calculation (34.4 MB/chunk).</p>
<p>Also, take note that the “Attributes” is still claming that <code class="docutils literal notranslate"><span class="pre">_ChunkSizes</span></code> is <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">23</span> <span class="pre">44]</span></code>. This
is clearly a lie (it was never really true, actually).  This is a particular oddity with OpenDAP
(or perhaps with this server), and won’t be a consideration if you are working with data from
other sources.</p>
<p>We’ve specifically asked the dask interface to request this data according to the chunk pattern
specified – and this is revealed in the graphical display.  Dask will make specific OPeNDAP
requests <em>per chunk</em> using appropriate query parameters to the server.</p>
<p>Because this chunk pattern can be provided by the server, and it is a reasonable pattern for
object storage in S3, we do <strong>not</strong> need to add the complexity of <code class="docutils literal notranslate"><span class="pre">rechunker</span></code>. We can just
have the zarr driver write it out according to the same plan.  Even so, it is useful to
lay out exactly what the chunking plan might be if we were using <code class="docutils literal notranslate"><span class="pre">rechunker</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunk_plan</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ppt&#39;</span><span class="p">:{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">},</span>    
    <span class="s1">&#39;tmx&#39;</span><span class="p">:{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">},</span>    
    <span class="s1">&#39;tnm&#39;</span><span class="p">:{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="mi">354</span><span class="p">},</span>
    <span class="s1">&#39;time_bnds&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;tbnd&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">621</span><span class="p">,),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1405</span><span class="p">,),</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1512</span><span class="p">,),</span>
    <span class="s1">&#39;tbnd&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the coordinate variables themselves (<code class="docutils literal notranslate"><span class="pre">lat</span></code>, <code class="docutils literal notranslate"><span class="pre">lon</span></code>, etc) are stored as single-chunk stripes of data.
Recall that these are used to translate a latitude (or longitude) value into the actual corresponding array
address.  These coordinate arrays will always be needed in their entirity, so we chunk them such that
they read with one chunk each. This does not affect how the data representing the data variables is chunked.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./101"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="ExamineSourceData.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Examine Source Data</p>
      </div>
    </a>
    <a class="right-next"
       href="OpenDAP_to_S3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Writing OpenDAP Data to ZARR on S3</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-chunk">Why Chunk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-data">Example Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-considerations">Shape Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dimension">Time Dimension</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#space">SPACE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#size-considerations">Size Considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#total-chunk-size">Total Chunk Size</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#making-the-chunk-plan">Making the chunk plan</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By HyTEST Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>